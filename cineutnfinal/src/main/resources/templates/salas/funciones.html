<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Funciones de la Sala - Cine UTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    .sala-info {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      border-left: 5px solid #0d6efd;
    }
    
    .sala-icon {
      font-size: 2.5rem;
      color: #0d6efd;
    }
    
    .funcion-card {
      transition: transform 0.2s;
      border-left: 4px solid #198754;
    }
    
    .funcion-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-5">
    <h1 class="text-center text-primary mb-4">
      <i class="fas fa-door-open"></i> Funciones de la Sala
    </h1>

    <!-- Información de la sala -->
    <div class="sala-info mb-4">
      <div class="row align-items-center">
        <div class="col-md-2 text-center">
          <i class="fas fa-theater-masks sala-icon"></i>
        </div>
        <div class="col-md-10">
          <h2 th:text="'Sala N° ' + ${sala.idSala}"></h2>
          <div class="row mt-3">
            <div class="col-md-4">
              <p><strong><i class="fas fa-chair"></i> Capacidad:</strong>
                <span th:text="${sala.cantDeButacas}"></span> butacas
              </p>
            </div>
            <div class="col-md-4">
              <p><strong><i class="fas fa-star"></i> Tipo:</strong>
                <span class="badge bg-primary" th:text="${sala.tipoSala.descripcion}"></span>
              </p>
            </div>
            <div class="col-md-4">
              <p><strong><i class="fas fa-film"></i> Total de funciones:</strong>
                <span class="badge bg-info" th:text="${#lists.size(sala.funcionesRealizadasSala)}"></span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botón Crear Función -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4 class="mb-0">
        <i class="fas fa-list"></i> Funciones Programadas
        <span class="badge bg-primary" th:text="${#lists.size(sala.funcionesRealizadasSala)}"></span>
      </h4>
    </div>

    <!-- Lista de funciones -->
    <div th:if="${not #lists.isEmpty(sala.funcionesRealizadasSala)}">
      <div class="row">
        <div th:each="funcion : ${sala.funcionesRealizadasSala}" class="col-lg-6 col-xl-4 mb-4">
          <div class="card funcion-card h-100">
            <div class="card-header bg-transparent">
              <div class="d-flex justify-content-between align-items-center">
                <h6 class="card-title mb-0" th:text="'Función #' + ${funcion.idFuncion}"></h6>
                <span class="badge" 
                      th:classappend="${funcion.cantButacasReservadas > 0} ? 'bg-warning' : 'bg-success'"
                      th:text="${funcion.cantButacasReservadas} + ' reservas'">
                </span>
              </div>
            </div>
            <div class="card-body">
              <p class="card-text">
                <strong><i class="fas fa-film text-primary"></i> Película:</strong><br>
                <span th:text="${funcion.pelicula.nombre}"></span>
              </p>
              
              <p class="card-text">
                <strong><i class="fas fa-clock text-primary"></i> Horario:</strong><br>
                <span th:text="${#temporals.format(funcion.horaInicio, 'dd/MM/yyyy HH:mm')}"></span>
              </p>
              
              <p class="card-text">
                <strong><i class="fas fa-hourglass-half text-primary"></i> Duración:</strong><br>
                <span th:text="${funcion.pelicula.duracionMin} + ' min'"></span>
              </p>
              
              <p class="card-text">
                <strong><i class="fas fa-users text-primary"></i> Butacas disponibles:</strong><br>
                <span th:text="${sala.cantDeButacas - funcion.cantButacasReservadas} + ' / ' + ${sala.cantDeButacas}"></span>
              </p>
            </div>
            <div class="card-footer bg-transparent text-center">
              <a th:href="@{/cineutn/reserva/lista/{idFuncion}(idFuncion=${funcion.idFuncion})}" 
                 class="btn btn-outline-primary btn-sm">
                <i class="fas fa-eye me-1"></i> Ver Detalles
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>


    <!-- Botón REGRESAR -->
    <div class="text-center mt-5">
      <a th:href="@{/cineutn/sala/crudsalas}" class="btn btn-secondary" id="btnRegresar">
        <i class="fas fa-arrow-left me-2"></i> REGRESAR
      </a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript para botón REGRESAR -->
  <script>
    // Función para volver a la página anterior
    document.getElementById('btnRegresar').addEventListener('click', function(e) {
      // Si hay una página anterior en el historial, volver a ella
      if (document.referrer && document.referrer !== window.location.href) {
        e.preventDefault();
        window.history.back();
      }
      // Si no hay historial, el enlace th:href normal funcionará
    });
  </script>
</body>

</html>