<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Eliminar Función - Cine UTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome para íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    .funcion-info {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      border-left: 5px solid #dc3545;
    }

    .funcion-icon {
      font-size: 2.5rem;
      color: #dc3545;
    }

    .badge-tipo {
      font-size: 0.9em;
      padding: 0.5em 0.75em;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-5">
    <h1 class="text-center text-danger">
      <i class="fas fa-calendar-times"></i> Confirmar Eliminación de Función
    </h1>

    <!-- Información de la función -->
    <div class="funcion-info mt-4" th:object="${funcion}">
      <div class="row align-items-center">
        <div class="col-md-2 text-center">
          <i class="fas fa-film funcion-icon"></i>
        </div>
        <div class="col-md-10">
          <h3 th:text="'Función #' + *{idFuncion}"></h3>
          <div class="row mt-3">
            <div class="col-md-6">
              <p><strong><i class="fas fa-ticket-alt"></i> Película:</strong>
                <span th:text="*{pelicula.nombre}"></span>
              </p>
              <p><strong><i class="fas fa-clock"></i> Horario:</strong>
                <span th:text="${#temporals.format(funcion.horaInicio, 'dd/MM/yyyy HH:mm')}"></span>
              </p>
            </div>
            <div class="col-md-6">
              <p><strong><i class="fas fa-door-open"></i> Sala:</strong>
                <span th:text="*{sala.idSala}"></span> -
                <span class="badge badge-tipo" 
                      th:classappend="*{sala.tipoSala.descripcion == 'Sala 2D'} ? 'bg-primary' : 'bg-success'"
                      th:text="*{sala.tipoSala.descripcion}"></span>
              </p>
              <p><strong><i class="fas fa-hourglass-half"></i> Duración:</strong>
                <span th:text="*{pelicula.duracionMin}"></span> minutos
              </p>
            </div>
          </div>
          
          <!-- Información de reservas existentes -->
          <div class="mt-3" th:if="${funcion.cantButacasReservadas > 0}">
            <p class="text-warning">
              <i class="fas fa-exclamation-triangle"></i>
              Esta función tiene <span th:text="${funcion.cantButacasReservadas}"></span> 
              butacas reservadas
            </p>
          </div>
          <div class="mt-2" th:unless="${funcion.cantButacasReservadas > 0}">
            <p class="text-success">
              <i class="fas fa-check-circle"></i>
              No hay reservas activas para esta función
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Alertas importantes -->
    <div class="alert alert-warning mt-4">
      <h4 class="alert-heading"><i class="fas fa-exclamation-circle"></i> ¡Atención!</h4>
      <p class="mb-2"><strong>NO SE ELIMINARÁN FUNCIONES QUE TENGAN RESERVAS ACTIVAS.</strong></p>
      <p class="mb-0">Si la función no tiene reservas asociadas, se eliminará permanentemente del sistema.</p>
    </div>

    <!-- Mensajes de error o éxito -->
    <div th:if="${error != null}" class="alert alert-danger alert-dismissible fade show mt-3">
      <i class="fas fa-exclamation-triangle me-2"></i>
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${mensaje != null}" class="alert alert-success alert-dismissible fade show mt-3">
      <i class="fas fa-check-circle me-2"></i>
      <span th:text="${mensaje}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Botones de acción -->
    <div class="d-flex justify-content-center mt-4">
      <form id="formEliminarFuncion" th:action="@{/cineutn/funcion/eliminar}" method="post">
        <input type="hidden" name="_method" value="delete">
        <input type="hidden" name="idFuncion" th:value="${funcion.idFuncion}" />
        
        <button type="submit" class="btn btn-danger me-2" 
                th:disabled="${funcion.cantButacasReservadas > 0}"
                onclick="return confirm('¿Está seguro que desea eliminar esta función?\nEsta acción no se puede deshacer.');">
          <i class="fas fa-trash-alt me-1"></i> Confirmar Eliminación
        </button>
        
        <a th:href="@{/cineutn/funcion/crudfunciones}" class="btn btn-secondary" id="btnVolver">
          <i class="fas fa-times me-1"></i> Cancelar
        </a>
      </form>
    </div>

    <!-- Información adicional si no se puede eliminar -->
    <div th:if="${funcion.cantButacasReservadas > 0}" class="text-center mt-3">
      <p class="text-muted">
        <small>
          <i class="fas fa-info-circle me-1"></i>
          Para eliminar esta función, primero debe cancelar las 
          <span th:text="${funcion.cantButacasReservadas}"></span> reserva(s) activa(s)
        </small>
      </p>
      <a th:href="@{/cineutn/reserva/lista/{idFuncion}(idFuncion=${funcion.idFuncion})}" 
         class="btn btn-outline-primary btn-sm">
        <i class="fas fa-list me-1"></i> Ver Reservas
      </a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript mínimo para botón volver -->
  <script>
    // Función para volver a la página anterior
    document.getElementById('btnVolver').addEventListener('click', function(e) {
      // Si hay una página anterior en el historial, volver a ella
      if (document.referrer && document.referrer !== window.location.href) {
        e.preventDefault();
        window.history.back();
      }
      // Si no hay historial, el enlace th:href normal funcionará
    });
  </script>
</body>

</html>