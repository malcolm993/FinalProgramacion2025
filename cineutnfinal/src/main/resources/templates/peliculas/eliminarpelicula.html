<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Eliminar Película - Cine UTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Font Awesome para íconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    .pelicula-info {
      background-color: #f8f9fa;
      border-radius: 10px;
      padding: 25px;
      border-left: 5px solid #dc3545;
    }

    .pelicula-icon {
      font-size: 2.5rem;
      color: #dc3545;
    }

    .badge-cartelera {
      font-size: 0.9em;
      padding: 0.5em 0.75em;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-5">
    <h1 class="text-center text-danger">
      <i class="fas fa-film"></i> Confirmar Eliminación de Película
    </h1>

    <!-- Información de la película -->
    <div class="pelicula-info mt-4" th:object="${pelicula}">
      <div class="row align-items-center">
        <div class="col-md-2 text-center">
          <i class="fas fa-video pelicula-icon"></i>
        </div>
        <div class="col-md-10">
          <h3 th:text="*{nombre}"></h3>
          <div class="row mt-3">
            <div class="col-md-6">
              <p><strong><i class="fas fa-clock"></i> Duración:</strong>
                <span th:text="*{duracionMin} + ' minutos'"></span>
              </p>
              <p><strong><i class="fas fa-user"></i> Director:</strong>
                <span th:text="*{director}"></span>
              </p>
            </div>
            <div class="col-md-6">
              <p><strong><i class="fas fa-ticket-alt"></i> Estado:</strong>
                <span class="badge badge-cartelera" 
                      th:classappend="*{cartelera} ? 'bg-success' : 'bg-secondary'"
                      th:text="*{cartelera} ? 'En cartelera' : 'Fuera de cartelera'"></span>
              </p>
            </div>
          </div>
          
          <div class="mt-3">
            <p><strong><i class="fas fa-align-left"></i> Sinopsis:</strong></p>
            <p class="fst-italic" th:text="*{sinopsis}"></p>
          </div>
          
          <!-- Información de funciones existentes -->
          <div class="mt-3" th:if="${not #lists.isEmpty(pelicula.funcionesAsociadas)}">
            <p class="text-warning">
              <i class="fas fa-exclamation-triangle"></i>
              Esta película tiene <span th:text="${#lists.size(pelicula.funcionesAsociadas)}"></span> 
              función(es) programada(s)
            </p>
          </div>
          <div class="mt-2" th:unless="${not #lists.isEmpty(pelicula.funciones)}">
            <p class="text-success">
              <i class="fas fa-check-circle"></i>
              No hay funciones activas para esta película
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Alertas importantes -->
    <div class="alert alert-warning mt-4">
      <h4 class="alert-heading"><i class="fas fa-exclamation-circle"></i> ¡Atención!</h4>
      <p class="mb-2"><strong>NO SE ELIMINARÁN PELÍCULAS QUE TENGAN FUNCIONES ACTIVAS.</strong></p>
      <p class="mb-0">Si la película no tiene funciones asociadas, se eliminará permanentemente del sistema junto con toda su información.</p>
    </div>

    <!-- Mensajes de error o éxito -->
    <div th:if="${error != null}" class="alert alert-danger alert-dismissible fade show mt-3">
      <i class="fas fa-exclamation-triangle me-2"></i>
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${mensaje != null}" class="alert alert-success alert-dismissible fade show mt-3">
      <i class="fas fa-check-circle me-2"></i>
      <span th:text="${mensaje}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Botones de acción -->
    <div class="d-flex justify-content-center mt-4">
      <form id="formBorrarPelicula" th:action="@{/cineutn/pelicula/eliminar/{id}(id=${pelicula.id})}" method="post">
        <input type="hidden" name="_method" value="delete">
        <input type="hidden" name="id" th:value="${pelicula.id}" />
        
        <button type="submit" class="btn btn-danger me-2" 
                th:disabled="${not #lists.isEmpty(pelicula.funciones)}"
                onclick="return confirm('¿Está seguro que desea eliminar esta película?\nEsta acción no se puede deshacer.');">
          <i class="fas fa-trash-alt me-1"></i> Confirmar Eliminación
        </button>
        
        <a th:href="@{/peliculas/crud}" class="btn btn-secondary" id="btnVolver">
          <i class="fas fa-times me-1"></i> Cancelar
        </a>
      </form>
    </div>

    <!-- Información adicional si no se puede eliminar -->
    <div th:if="${not #lists.isEmpty(pelicula.funciones)}" class="text-center mt-3">
      <p class="text-muted">
        <small>
          <i class="fas fa-info-circle me-1"></i>
          Para eliminar esta película, primero debe eliminar las 
          <span th:text="${#lists.size(pelicula.funciones)}"></span> función(es) activa(s)
        </small>
      </p>
      <a th:href="@{/cineutn/funcion/crudfunciones}" class="btn btn-outline-primary btn-sm">
        <i class="fas fa-list me-1"></i> Ver Funciones
      </a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript para botón volver -->
  <script>
    // Función para volver a la página anterior
    document.getElementById('btnVolver').addEventListener('click', function(e) {
      // Si hay una página anterior en el historial, volver a ella
      if (document.referrer && document.referrer !== window.location.href) {
        e.preventDefault();
        window.history.back();
      }
      // Si no hay historial, el enlace th:href normal funcionará
    });
  </script>
</body>

</html>