<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Comprar Entradas - Cine UTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    .funcion-card {
      transition: transform 0.3s ease;
      border: 1px solid #dee2e6;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .funcion-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .btn-comprar {
      background: linear-gradient(45deg, #28a745, #20c997);
      border: none;
      padding: 10px 20px;
      font-weight: bold;
    }

    .btn-comprar:hover {
      background: linear-gradient(45deg, #218838, #1aa179);
      transform: scale(1.05);
    }

    .badge-disponible {
      background-color: #198754;
    }

    .badge-agotado {
      background-color: #dc3545;
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-4">
    <div class="row">
      <div class="col-12">
        <h1 class="text-center mb-4">
          <i class="fas fa-ticket-alt me-2"></i>Comprar Entradas
        </h1>

        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          Selecciona la función a la que deseas asistir y haz clic en "Comprar Entrada"
        </div>
      </div>
    </div>

    <!-- Mensajes de feedback -->
    <div th:if="${error != null}" class="alert alert-danger alert-dismissible fade show">
      <strong><i class="fas fa-exclamation-circle me-2"></i>Error!</strong>
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show">
      <i class="fas fa-check-circle me-2"></i>
      <span th:text="${mensaje}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="accordion accordion-flush" id="accordionFunciones">

      <!-- Funciones 2D -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading2D">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapse2D"
            aria-expanded="true" aria-controls="collapse2D">
            <i class="fas fa-film me-2"></i>FUNCIONES 2D
          </button>
        </h2>
        <div id="collapse2D" class="accordion-collapse collapse show" aria-labelledby="heading2D"
          data-bs-parent="#accordionFunciones">
          <div class="accordion-body">
            <div class="row">
              <div th:each="funcion : ${funciones}" th:if="${funcion.sala.getTipoSalaDescripcion == 'Sala 2D'}"
                class="col-lg-6 mb-3">
                <div class="card funcion-card h-100">
                  <div class="card-header bg-primary text-white">
                    <h6 class="card-title mb-0">
                      <i class="fas fa-calendar-alt me-2"></i>
                      <span th:text="${funcion.pelicula.nombre}"></span>
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="mb-2">
                      <strong><i class="fas fa-clock me-2"></i>Horario:</strong>
                      <span th:text="${funcion.horaInicio}"></span> -
                      <span th:text="${funcion.horaFin}"></span>
                    </div>
                    <div class="mb-2">
                      <strong><i class="fas fa-door-open me-2"></i>Sala:</strong>
                      <span th:text="${funcion.sala.idSala}"></span> -
                      <span th:text="${funcion.sala.getTipoSalaDescripcion}"></span>
                    </div>
                    <div class="mb-2">
                      <strong><i class="fas fa-hourglass-half me-2"></i>Duración:</strong>
                      <span th:text="${funcion.pelicula.duracionMin}"></span> min
                    </div>
                    <div class="mb-3">
                      <strong><i class="fas fa-chair me-2"></i>Disponibilidad:</strong>
                      <span class="badge"
                        th:class="${funcion.cantButacasReservadas > 0} ? 'badge-disponible' : 'badge-agotado'"
                        th:text="${funcion.cantButacasReservadas} + ' butacas disponibles'">
                      </span>
                    </div>
                  </div>
                  <div class="card-footer bg-transparent text-center">
                    <a th:href="@{/cineutn/reserva/comprar/{idFuncion}(idFuncion=${funcion.idFuncion})}"
                      class="btn btn-comprar btn-lg" th:disabled="${funcion.cantButacasReservadas == 0}">
                      <i class="fas fa-shopping-cart me-2"></i>Comprar Entrada
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Funciones 3D -->
      <div class="accordion-item">
        <h2 class="accordion-header" id="heading3D">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
            data-bs-target="#collapse3D" aria-expanded="false" aria-controls="collapse3D">
            <i class="fas fa-vr-cardboard me-2"></i>FUNCIONES 3D
          </button>
        </h2>
        <div id="collapse3D" class="accordion-collapse collapse" aria-labelledby="heading3D"
          data-bs-parent="#accordionFunciones">
          <div class="accordion-body">
            <div class="row">
              <div th:each="funcion : ${funciones}" th:if="${funcion.sala.getTipoSalaDescripcion == 'Sala 3D'}"
                class="col-lg-6 mb-3">
                <div class="card funcion-card h-100">
                  <div class="card-header bg-success text-white">
                    <h6 class="card-title mb-0">
                      <i class="fas fa-calendar-alt me-2"></i>
                      <span th:text="${funcion.pelicula.nombre}"></span>
                    </h6>
                  </div>
                  <div class="card-body">
                    <div class="mb-2">
                      <strong><i class="fas fa-clock me-2"></i>Horario:</strong>
                      <span th:text="${funcion.horaInicio}"></span> -
                      <span th:text="${funcion.horaFin}"></span>
                    </div>
                    <div class="mb-2">
                      <strong><i class="fas fa-door-open me-2"></i>Sala:</strong>
                      <span th:text="${funcion.sala.idSala}"></span> -
                      <span th:text="${funcion.sala.getTipoSalaDescripcion}"></span>
                    </div>
                    <div class="mb-2">
                      <strong><i class="fas fa-hourglass-half me-2"></i>Duración:</strong>
                      <span th:text="${funcion.pelicula.duracionMin}"></span> min
                    </div>
                    <div class="mb-2">
                      <strong><i class="fas fa-money-bill-wave me-2"></i>Precio:</strong>
                      $<span th:text="${#numbers.formatDecimal(funcion.precioEntrada, 0, 'COMMA', 2, 'POINT')}"></span>
                    </div>
                    <div class="mb-3">
                      <strong><i class="fas fa-chair me-2"></i>Disponibilidad:</strong>
                      <span class="badge"
                        th:class="${funcion.cantButacasReservadas > 0} ? 'badge-disponible' : 'badge-agotado'"
                        th:text="${funcion.cantButacasReservadas} + ' butacas disponibles'">
                      </span>
                    </div>
                  </div>
                  <div class="card-footer bg-transparent text-center">
                    <a th:href="@{/cineutn/reserva/comprar/{idFuncion}(idFuncion=${funcion.idFuncion})}"
                      class="btn btn-comprar btn-lg" th:disabled="${funcion.cantButacasReservadas == 0}">
                      <i class="fas fa-shopping-cart me-2"></i>Comprar Entrada
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-center mt-4 mb-5">
      <a th:href="@{/}" class="btn btn-primary">
        <i class="fas fa-home me-2"></i>Volver al inicio
      </a>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>