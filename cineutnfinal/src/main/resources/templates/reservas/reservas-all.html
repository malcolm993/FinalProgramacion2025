<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>Mis Reservas - Cine UTN</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
  <style>
    .reserva-card {
      transition: transform 0.2s;
      border-left: 4px solid #0d6efd;
    }
    
    .reserva-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .badge-estado {
      font-size: 0.8em;
      padding: 0.4em 0.6em;
    }
    
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #6c757d;
    }
    
    .table-hover tbody tr:hover {
      background-color: rgba(13, 110, 253, 0.05);
    }
  </style>
</head>

<body>
  <!-- Navbar -->
  <div th:replace="~{fragments/navbar :: navbar}"></div>

  <div class="container mt-5">
    <h1 class="text-center text-primary mb-4">
      <i class="fas fa-ticket-alt"></i> TODAS LAS RESERVAS 
    </h1>


    <!-- Listado de Reservas -->
    <div th:if="${not #lists.isEmpty(listaReservas)}">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <i class="fas fa-list"></i> Reservas Activas
          </h4>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover table-striped mb-0">
              <thead class="table-dark">
                <tr>
                  <th><i class="fas fa-hashtag"></i> ID Reserva</th>
                  <th><i class="fas fa-film"></i> Película</th>
                  <th><i class="fas fa-calendar-day"></i> Fecha</th>
                  <th><i class="fas fa-clock"></i> Horario</th>
                  <th><i class="fas fa-door-open"></i> Sala</th>
                  <th><i class="fas fa-chair"></i> Asientos</th>
                  <th><i class="fas fa-user"></i> ID Usuario</th>
                  <th><i class="fas fa-cog"></i> Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="reserva : ${listaReservas}" class="reserva-card">
                  <td>
                    <strong th:text="${reserva.id}">#</strong>
                  </td>
                  <td>
                    <span th:text="${reserva.funcionReservada.pelicula.nombre}">Película</span>
                  </td>
                  <td>
                    <span th:text="${#temporals.format(reserva.funcionReservada.horaInicio, 'dd/MM/yyyy')}">Fecha</span>
                  </td>
                  <td>
                    <span th:text="${#temporals.format(reserva.funcionReservada.horaInicio, 'HH:mm')}">Horario</span>
                  </td>
                  <td>
                    <span class="badge" 
                          th:classappend="${reserva.funcionReservada.sala.tipoSala.descripcion == 'Sala 2D'} ? 'bg-primary' : 'bg-success'"
                          th:text="${reserva.funcionReservada.sala.tipoSala.descripcion}">Sala</span>
                  </td>
                  <td>
                    <span class="badge bg-info" th:text="${reserva.cantidadEntradas}">0</span> asientos
                  </td>
                  <td>
                    <small class="text-muted" th:text="${reserva.usuarioComprador.id}">UID</small>
                  </td>
                  <td>
                    <div class="btn-group btn-group-sm">
                      <a th:href="@{/cineutn/reserva/detalle/{id}(id=${reserva.id})}" 
                         class="btn btn-outline-primary" title="Ver detalles">
                        <i class="fas fa-eye"></i>
                      </a>
                      <a th:href="@{/cineutn/reserva/cancelar/{id}(id=${reserva.id})}" 
                         class="btn btn-outline-danger" 
                         th:onclick="'return confirm(\'¿Está seguro que desea cancelar la reserva #' + ${reserva.id} + '?\');'"
                         title="Cancelar reserva">
                        <i class="fas fa-times"></i>
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Estadísticas -->
      <div class="row mt-4">
        <div class="col-md-3">
          <div class="card text-center">
            <div class="card-body">
              <h3 class="text-success" th:text="${#lists.size(listaReservas)}">0</h3>
              <p class="text-muted">Total Reservas</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Estado vacío -->
    <div th:unless="${not #lists.isEmpty(listaReservas)}" class="empty-state">
      <i class="fas fa-ticket-alt fa-4x mb-3"></i>
      <h3>No hay reservas realizadas</h3>
      <p class="text-muted">Aún no has realizado ninguna reserva.</p>
      <a th:href="@{/cineutn/funcion/cartelera}" class="btn btn-primary mt-3">
        <i class="fas fa-film me-2"></i>Ver Cartelera
      </a>
    </div>

    <!-- Botón de volver -->
    <div class="d-flex justify-content-center mt-5">
      <a th:href="@{/cineutn}" class="btn btn-secondary" id="btnVolver">
        <i class="fas fa-arrow-left me-2"></i> Volver al Inicio
      </a>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- JavaScript para mejoras de UX -->
  <script>
    // Confirmación antes de cancelar reservas
    document.querySelectorAll('a[href*="cancelar"]').forEach(link => {
      link.addEventListener('click', function(e) {
        const reservaId = this.getAttribute('href').split('/').pop();
        if (!confirm('¿Está seguro que desea cancelar la reserva #' + reservaId + '?')) {
          e.preventDefault();
        }
      });
    });

    // Función para volver atrás
    document.getElementById('btnVolver').addEventListener('click', function(e) {
      if (document.referrer && document.referrer !== window.location.href) {
        e.preventDefault();
        window.history.back();
      }
    });
  </script>
</body>

</html>